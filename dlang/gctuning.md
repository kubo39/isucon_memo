# GCチューニング

## D言語のGC

D言語のGCは現時点では

- 古典的マーク&スウィープ
- コピーしないので再配置(詰め直し)はしない
- インクリメンタルに実行しない
- いくつかのサイズごとにメモリブロックが用意されている

なので

- ストップザワールドが発生する
- 基本的にGCが走るとヒープは全部舐める
- メモリフラグメントが起きる

## GCの実行タイミング

core.memory 内にGCを操作するための関数が用意されている。

基本的にチューニングで大事なのは

- GC.collect - Full GCを実行する
- GC.stats - GC管理下のメモリ情報を取得する
- GC.disable - GCを無効化する
- GC.enable - GCを有効にする

あたりの関数で実行タイミングを操作できる

## GC Config

D言語は実行時にコマンドラインで `"--DRT-gcopt"` を渡してGCの調整ができる

例)

```console
$ ./app.bin "--DRT-gcopt=profile:1 minPoolSize:16"
(...)
```

オプションの一部を抜粋

- profile - 1でプロファイル機能を有効, 0で無効
- minPoolsize - 最小のメモリプールサイズを変更
- maxPoolSize - 最大のメモリプールサイズを変更
